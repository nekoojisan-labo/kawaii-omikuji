<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>かわいいおみくじ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #ffb3e6 0%, #b3d9ff 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            position: relative;
        }

        /* 共通スクリーン設定 */
        .screen {
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.5s ease-in-out;
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            width: calc(100% - 40px);
        }

        .screen.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            position: relative;
            top: auto;
            left: auto;
            right: auto;
            width: auto;
        }

        /* メイン画面 */
        .header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .title {
            font-size: clamp(2rem, 5vw, 2.5rem);
            color: #ff6b9d;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 0.625rem;
            animation: bounce 2s infinite;
            line-height: 1.2;
        }

        .subtitle {
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: #666;
            font-weight: 300;
        }

        .omikuji-box {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 30px;
            padding: clamp(30px, 5vw, 40px);
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .omikuji-illustration {
            margin-bottom: 2rem;
            position: relative;
            height: 100px;
        }

        .shrine {
            font-size: clamp(3rem, 8vw, 4rem);
            animation: float 3s ease-in-out infinite;
        }

        .clouds {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: clamp(1.5rem, 4vw, 2rem);
            opacity: 0.7;
            animation: drift 5s ease-in-out infinite;
            white-space: nowrap;
        }

        .draw-button {
            background: linear-gradient(45deg, #ff6b9d, #ffa726);
            border: none;
            border-radius: 25px;
            padding: clamp(15px, 3vw, 20px) clamp(30px, 5vw, 40px);
            font-size: clamp(1.2rem, 3.5vw, 1.5rem);
            color: white;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.4);
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }

        .draw-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.6);
        }

        .draw-button:active {
            transform: translateY(0);
        }

        .button-sparkle {
            position: absolute;
            top: 10px;
            right: 15px;
            animation: sparkle 1.5s ease-in-out infinite;
        }

        /* 抽選アニメーション画面 */
        .loading-animation {
            text-align: center;
            padding: clamp(50px, 10vw, 100px) 0;
        }

        .spinning-omikuji {
            font-size: clamp(4rem, 10vw, 5rem);
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
            display: inline-block;
        }

        .loading-text {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            color: #666;
            margin-bottom: 1.25rem;
        }

        .loading-dots {
            display: flex;
            justify-content: center;
            gap: 6px;
        }

        .loading-dots span {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff6b9d;
            animation: loading-bounce 1.4s ease-in-out infinite both;
        }

        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }

        /* 結果表示画面 */
        .result-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: clamp(20px, 4vw, 30px);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .fortune-name {
            font-size: clamp(2.5rem, 6vw, 3rem);
            font-weight: bold;
            margin-bottom: 0.625rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .fortune-icon {
            font-size: clamp(3rem, 8vw, 4rem);
            animation: pulse 2s ease-in-out infinite;
        }

        /* 運勢別の色設定 */
        .result-header.daikichi {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #b8860b;
        }

        .result-header.chukichi {
            background: linear-gradient(135deg, #ff9500, #ffb347);
            color: #cc5500;
        }

        .result-header.shokichi {
            background: linear-gradient(135deg, #ff69b4, #ffb6c1);
            color: #c71585;
        }

        .result-header.kichi {
            background: linear-gradient(135deg, #32cd32, #90ee90);
            color: #228b22;
        }

        .result-header.suekichi {
            background: linear-gradient(135deg, #87ceeb, #b0e0e6);
            color: #4682b4;
        }

        .result-header.kyo {
            background: linear-gradient(135deg, #9370db, #dda0dd);
            color: #663399;
        }

        .result-header.daikyo {
            background: linear-gradient(135deg, #483d8b, #6a5acd);
            color: #ffffff;
        }

        .advice-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: clamp(20px, 4vw, 30px);
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-height: 60vh;
            overflow: hidden;
        }

        .advice-scroll {
            max-height: calc(60vh - 60px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-right: 10px;
        }

        .advice-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .advice-scroll::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
            border-radius: 3px;
        }

        .advice-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 157, 0.3);
            border-radius: 3px;
        }

        .advice-item {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            border-left: 5px solid #ff6b9d;
            transition: all 0.3s ease;
        }

        .advice-item:last-child {
            margin-bottom: 0;
        }

        .advice-item h3 {
            color: #ff6b9d;
            margin-bottom: 0.5rem;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .advice-item .emoji {
            font-size: 1.3em;
        }

        .advice-item p {
            color: #555;
            line-height: 1.6;
            font-size: clamp(0.875rem, 2vw, 1rem);
        }

        .retry-button {
            width: 100%;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            border-radius: 15px;
            padding: clamp(12px, 2.5vw, 15px);
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }

        .retry-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(78, 205, 196, 0.6);
        }

        .retry-button:active {
            transform: translateY(0);
        }

        /* アニメーション */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes drift {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-40%) translateY(-5px); }
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes loading-bounce {
            0%, 80%, 100% { transform: scale(0); opacity: 0; }
            40% { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* レスポンシブ対応 */
        @media (max-width: 768px) and (min-width: 481px) {
            .container {
                padding: 15px;
            }
            
            .advice-container {
                max-height: 50vh;
            }
            
            .advice-scroll {
                max-height: calc(50vh - 40px);
            }
        }

        /* スマートフォン対応 */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .header {
                margin-bottom: 2rem;
            }
            
            .omikuji-box {
                padding: 25px;
            }
            
            .omikuji-illustration {
                height: 80px;
                margin-bottom: 1.5rem;
            }
            
            .advice-container {
                max-height: 55vh;
                padding: 20px;
            }
            
            .advice-scroll {
                max-height: calc(55vh - 40px);
                padding-right: 5px;
            }
            
            .advice-item {
                margin-bottom: 1rem;
                padding: 0.75rem;
            }
        }

        /* 横向き対応 */
        @media (orientation: landscape) and (max-height: 600px) {
            .container {
                padding: 10px;
            }
            
            .header {
                margin-bottom: 1rem;
            }
            
            .omikuji-illustration {
                height: 60px;
                margin-bottom: 1rem;
            }
            
            .advice-container {
                max-height: 40vh;
            }
            
            .advice-scroll {
                max-height: calc(40vh - 40px);
            }
        }

        /* アクセシビリティ対応 */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }

        /* ダークモード対応 */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            }
            
            .omikuji-box,
            .advice-container {
                background: rgba(45, 55, 72, 0.9);
                color: #e2e8f0;
            }
            
            .subtitle,
            .loading-text,
            .advice-item p {
                color: #cbd5e0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- メイン画面 -->
        <div id="main-screen" class="screen active">
            <div class="header">
                <h1 class="title">🌸 かわいいおみくじ 🌸</h1>
                <p class="subtitle">今日の運勢を占ってみよう！</p>
            </div>
            
            <div class="omikuji-box">
                <div class="omikuji-illustration">
                    <div class="shrine">⛩️</div>
                    <div class="clouds">☁️ ☁️</div>
                </div>
                
                <button id="draw-button" class="draw-button" type="button" aria-label="おみくじを引く">
                    <span class="button-text">おみくじを引く！</span>
                    <div class="button-sparkle">✨</div>
                </button>
            </div>
        </div>

        <!-- 抽選アニメーション画面 -->
        <div id="loading-screen" class="screen">
            <div class="loading-animation">
                <div class="spinning-omikuji">🎋</div>
                <p class="loading-text">運勢を占っています...</p>
                <div class="loading-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <!-- 結果表示画面 -->
        <div id="result-screen" class="screen">
            <div id="result-header" class="result-header">
                <div id="fortune-name" class="fortune-name"></div>
                <div id="fortune-icon" class="fortune-icon"></div>
            </div>
            
            <div class="advice-container">
                <div class="advice-scroll">
                    <div class="advice-item">
                        <h3><span class="emoji">🌟</span> 願望</h3>
                        <p id="advice-wish"></p>
                    </div>
                    <div class="advice-item">
                        <h3><span class="emoji">💪</span> 健康</h3>
                        <p id="advice-health"></p>
                    </div>
                    <div class="advice-item">
                        <h3><span class="emoji">💼</span> 仕事</h3>
                        <p id="advice-work"></p>
                    </div>
                    <div class="advice-item">
                        <h3><span class="emoji">💕</span> 恋愛</h3>
                        <p id="advice-love"></p>
                    </div>
                    <div class="advice-item">
                        <h3><span class="emoji">📚</span> 学問</h3>
                        <p id="advice-study"></p>
                    </div>
                    <div class="advice-item">
                        <h3><span class="emoji">💰</span> 金運</h3>
                        <p id="advice-money"></p>
                    </div>
                    <div class="advice-item">
                        <h3><span class="emoji">✈️</span> 旅行</h3>
                        <p id="advice-travel"></p>
                    </div>
                    <div class="advice-item">
                        <h3><span class="emoji">🔍</span> 失物</h3>
                        <p id="advice-lost"></p>
                    </div>
                    <div class="advice-item">
                        <h3><span class="emoji">⚖️</span> 争事</h3>
                        <p id="advice-trouble"></p>
                    </div>
                </div>
            </div>
            
            <button id="retry-button" class="retry-button" type="button" aria-label="もう一度引く">
                もう一度引く 🔄
            </button>
        </div>
    </div>

    <script>
        // おみくじデータ
        const FORTUNE_CONFIG = {
            daikichi: { weight: 5, name: '大吉', icon: '🌟', class: 'daikichi' },
            chukichi: { weight: 20, name: '中吉', icon: '⭐', class: 'chukichi' },
            shokichi: { weight: 30, name: '小吉', icon: '✨', class: 'shokichi' },
            kichi: { weight: 20, name: '吉', icon: '🍀', class: 'kichi' },
            suekichi: { weight: 15, name: '末吉', icon: '🌸', class: 'suekichi' },
            kyo: { weight: 8, name: '凶', icon: '🌙', class: 'kyo' },
            daikyo: { weight: 2, name: '大凶', icon: '⚡', class: 'daikyo' }
        };

        // サンプルアドバイスデータ（実際には各運勢×各項目×20パターンを用意）
        const ADVICE_DATA = {
            daikichi: {
                wish: [
                    "今こそチャレンジの時。夢に向かって一歩踏み出しましょう。あなたの思いはきっと実現します。",
                    "願いが叶う最高のタイミングです。自信を持って行動してください。",
                    "心の奥底にある願いも現実になりそうです。積極的に動きましょう。"
                ],
                health: [
                    "体調も気分も絶好調。無理は禁物ですが、活動的な一日を過ごすのに最適です。",
                    "健康運が最高潮に達しています。新しい運動を始めるのも良いでしょう。",
                    "心身ともに充実した状態です。エネルギーに満ち溢れています。"
                ],
                work: [
                    "努力が実を結び、大きな成果につながるチャンス到来。積極的に新しい仕事に取り組むと吉。",
                    "仕事運が絶好調です。重要なプロジェクトを任されるかもしれません。",
                    "職場での評価が急上昇し、昇進や昇格の可能性があります。"
                ],
                love: [
                    "良い出会いの兆し。素直に自分の気持ちを伝えましょう。今が運命の分かれ道。",
                    "恋愛運が最高潮です。理想の相手との出会いが期待できます。",
                    "既にパートナーがいる方は、関係がさらに深まりそうです。"
                ],
                study: [
                    "好奇心が実を結ぶ時期。新たな学びにチャレンジし、知識やスキルを深めましょう。",
                    "学習効果が最大限に発揮される時期です。難しい内容もスムーズに理解できます。",
                    "試験や資格取得に挑戦するには絶好のタイミングです。"
                ],
                money: [
                    "収入増の可能性。計画的に財布のひもを緩めるとよいでしょう。投資や副業にも目を向けて。",
                    "金運が絶好調です。臨時収入や昇給の可能性があります。",
                    "投資や資産運用で良い結果が期待できます。"
                ],
                travel: [
                    "旅先で幸運な出会いや発見あり。思い切って遠出するとよき思い出ができます。",
                    "旅行運が最高です。どこに行っても素晴らしい体験ができるでしょう。",
                    "旅先で人生を変える出会いがあるかもしれません。"
                ],
                lost: [
                    "無くした物も無事に見つかりそう。焦らず丁寧に探してください。",
                    "失物運が良好です。思わぬ場所から見つかるかもしれません。",
                    "なくしたものが意外な形で戻ってくるでしょう。"
                ],
                trouble: [
                    "揉め事やトラブルは自然と解決へ。過剰に気にせず、冷静に対処してください。",
                    "トラブル解決運が最高です。どんな問題も良い方向に向かいます。",
                    "争いごとが平和的に解決し、関係者全員が納得できる結果になります。"
                ]
            },
            chukichi: {
                wish: [
                    "現実的に目標を設定し、コツコツ努力を続けてください。願いは思ったより早く叶うでしょう。",
                    "願いが叶うまでもう少し時間がかかりますが、着実に近づいています。",
                    "小さな願いから順番に叶えていくと良いでしょう。"
                ],
                health: [
                    "体調に大きな変動はないが、無理は禁物。休息とバランスの良い食事を心がけて。",
                    "健康状態は安定していますが、予防を心がけましょう。",
                    "適度な運動を続けることで、より良い体調を維持できます。"
                ],
                work: [
                    "地道な努力が実る時期。焦らずに自分のペースで進めてください。",
                    "同僚や上司とのコミュニケーションを大切にすると良い結果に。",
                    "今の仕事を丁寧にこなすことで、次のチャンスが見えてきます。"
                ],
                love: [
                    "進展はゆっくりですが、誠実な態度が相手に伝わるでしょう。",
                    "急がずに丁寧な関係を築いていくことが大切です。",
                    "相手の気持ちを考えながら、少しずつ距離を縮めていきましょう。"
                ],
                study: [
                    "今の努力が少しずつ実を結びます。油断せずにコツコツ学びを続けてください。",
                    "基礎をしっかり固めることで、応用力が身につきます。",
                    "学習計画を立てて、着実に進めていきましょう。"
                ],
                money: [
                    "お金の出入りは安定。衝動買いや無駄遣いに注意し、節約を心がけて。",
                    "大きな出費は控えめにして、貯蓄を増やす時期です。",
                    "収入は安定していますが、将来に備えて計画的に。"
                ],
                travel: [
                    "近場の小旅行で気分転換を。大きな移動は控えめに。",
                    "日帰り旅行や近場の温泉などがおすすめです。",
                    "旅行の計画は慎重に。下調べをしっかりとしましょう。"
                ],
                lost: [
                    "しばらく探しても見つからない場合は、諦めずに再度探すと見つかるかも。",
                    "失くしたものは意外と身近な場所にあるかもしれません。",
                    "家族や友人に協力してもらうと見つかりやすいでしょう。"
                ],
                trouble: [
                    "小さなトラブルはあっても大きな問題には発展しにくい。冷静に対応すれば問題ありません。",
                    "話し合いで解決できることが多いでしょう。",
                    "第三者の意見を聞くことで、良い解決策が見つかります。"
                ]
            },
            shokichi: {
                wish: [
                    "焦る必要はありません。願いは叶うまで時間がかかることもありますが、諦めずに続けましょう。",
                    "小さな目標から達成していくことで、大きな願いに近づけます。",
                    "今は準備期間と考えて、着実に進んでいきましょう。"
                ],
                health: [
                    "体調に大きな問題はありませんが、油断は禁物。睡眠と栄養をしっかりとり、無理をしないように。",
                    "疲れを感じたら早めに休息を取ることが大切です。",
                    "規則正しい生活を心がけることで、体調を維持できます。"
                ],
                work: [
                    "目立った成果はないものの、着実に仕事は進んでいます。今は小さな積み重ねが大切な時期。",
                    "地道な作業も丁寧にこなすことで、信頼を得られます。",
                    "新しいスキルを身につける良い機会です。"
                ],
                love: [
                    "進展はゆっくりですが、丁寧なコミュニケーションがカギ。相手の気持ちを大切にしながら、焦らずに。",
                    "友達から始めることで、良い関係が築けるでしょう。",
                    "相手のペースに合わせることが大切です。"
                ],
                study: [
                    "結果が出るまでにはもう少し時間がかかりそうです。諦めずに基礎を固めて。",
                    "復習を重視することで、確実に力がつきます。",
                    "わからないことは恥ずかしがらずに質問しましょう。"
                ],
                money: [
                    "大きな収入や支出はありませんが、無駄遣いに注意。貯蓄や節約に努めてください。",
                    "小さな節約の積み重ねが、将来の安心につながります。",
                    "お金の使い方を見直す良い機会です。"
                ],
                travel: [
                    "遠出は控えめに。近場でのリフレッシュが吉。",
                    "身近な場所で新しい発見があるかもしれません。",
                    "旅行よりも日常を充実させることを優先しましょう。"
                ],
                lost: [
                    "なくした物はすぐには出てきませんが、時間を置いて探すと見つかることも。",
                    "記憶を辿って、最後に使った場所を思い出してみましょう。",
                    "諦めかけた頃に見つかることがあります。"
                ],
                trouble: [
                    "小さなトラブルは起きやすいですが、大きな問題にはなりません。冷静に対処してください。",
                    "感情的にならずに、事実を整理することが大切です。",
                    "時間が解決してくれることもあります。"
                ]
            },
            kichi: {
                wish: [
                    "願いは着実に近づいています。今のペースで進んでいけば良いでしょう。",
                    "目標に向かって順調に進んでいます。自信を持って。",
                    "周囲の協力も得られやすい時期です。"
                ],
                health: [
                    "健康状態は良好です。今の生活習慣を維持しましょう。",
                    "体調管理がうまくいっています。この調子で。",
                    "心身ともにバランスの取れた状態です。"
                ],
                work: [
                    "仕事は順調に進んでいます。今の調子を維持してください。",
                    "努力が認められる時期です。自信を持って取り組みましょう。",
                    "新しいチャンスも巡ってきそうです。"
                ],
                love: [
                    "恋愛運は安定しています。相手との関係を大切に育てていきましょう。",
                    "素直な気持ちを伝えることで、良い関係が築けます。",
                    "相手を思いやる気持ちが幸せを呼びます。"
                ],
                study: [
                    "学習は順調に進んでいます。この調子で続けていきましょう。",
                    "理解力が高まっている時期です。難しい内容にも挑戦を。",
                    "努力の成果が少しずつ現れてきています。"
                ],
                money: [
                    "金運は安定しています。計画的な使い方を心がけましょう。",
                    "収支のバランスが取れています。この調子で。",
                    "将来への投資を考える良い時期です。"
                ],
                travel: [
                    "旅行運は良好です。計画を立てて楽しい旅を。",
                    "新しい場所での発見が期待できます。",
                    "リフレッシュできる良い旅になるでしょう。"
                ],
                lost: [
                    "失くしたものは見つかる可能性が高いです。落ち着いて探しましょう。",
                    "意外な場所から出てくるかもしれません。",
                    "周囲の人に聞いてみると手がかりが得られそうです。"
                ],
                trouble: [
                    "トラブルは少なく、あっても軽微なものです。",
                    "問題が起きても、すぐに解決できるでしょう。",
                    "周囲との関係も良好で、協力が得られます。"
                ]
            },
            suekichi: {
                wish: [
                    "願いの実現にはもう少し時間と努力が必要です。焦らずに。",
                    "小さな一歩から始めることが大切です。",
                    "周囲の意見も参考にしながら進めていきましょう。"
                ],
                health: [
                    "体調管理に注意が必要です。無理をせず、休息を大切に。",
                    "ストレスを溜めないよう、リラックスする時間を作りましょう。",
                    "早寝早起きを心がけると良いでしょう。"
                ],
                work: [
                    "仕事は慎重に進める必要があります。確認を怠らずに。",
                    "ミスを防ぐため、丁寧な作業を心がけましょう。",
                    "上司や同僚との相談を大切にしてください。"
                ],
                love: [
                    "恋愛は慎重に進めることが大切です。相手の気持ちを確認しながら。",
                    "急がず、ゆっくりと関係を深めていきましょう。",
                    "友人のアドバイスも参考になるでしょう。"
                ],
                study: [
                    "学習には根気が必要な時期です。基礎を大切に。",
                    "わからないところは、そのままにせず解決しましょう。",
                    "計画的に進めることで、着実に力がつきます。"
                ],
                money: [
                    "金運は控えめです。無駄遣いを避け、節約を心がけて。",
                    "大きな買い物は慎重に検討しましょう。",
                    "貯蓄を始めるには良い時期です。"
                ],
                travel: [
                    "旅行は計画を綿密に立てることが大切です。",
                    "予期せぬトラブルに備えて、準備をしっかりと。",
                    "無理のない行程で楽しみましょう。"
                ],
                lost: [
                    "失くしたものを見つけるには時間がかかりそうです。",
                    "記憶を整理して、順番に探していきましょう。",
                    "見つからない場合は、新しいものを検討することも。"
                ],
                trouble: [
                    "小さなトラブルに注意が必要です。早めの対処を。",
                    "問題を先送りにせず、その都度解決しましょう。",
                    "冷静な判断が求められる時期です。"
                ]
            },
            kyo: {
                wish: [
                    "今は焦らず待つ時期。思い通りにならないこともありますが、あせらず状況の変化を待ちましょう。",
                    "願いの実現には時間がかかります。今は準備期間と考えて。",
                    "目標を見直し、現実的な計画を立て直しましょう。"
                ],
                health: [
                    "体調に気をつけて。不安があれば早めに医師に相談を。無理はしないでください。",
                    "休息を十分に取り、体力の回復に努めましょう。",
                    "ストレス管理が特に重要な時期です。"
                ],
                work: [
                    "トラブルや失敗が起きやすい時期。確認や準備を怠らず、慎重に対応してください。",
                    "新しいことは避け、現状維持に努めましょう。",
                    "ミスを防ぐため、ダブルチェックを心がけて。"
                ],
                love: [
                    "深入りは避けて。相手との関係も少し距離を置き、冷静に判断を。",
                    "今は自分自身を見つめ直す時期です。",
                    "新しい出会いよりも、自己成長に集中しましょう。"
                ],
                study: [
                    "今の努力が結果に結びつきにくい時期。諦めず、次回に向けて力を蓄えてください。",
                    "基礎に戻って、じっくりと学び直しましょう。",
                    "焦らず、自分のペースで進めることが大切です。"
                ],
                money: [
                    "お金のやりくりが難しい時期。無理な買い物や投資は控え、堅実に。",
                    "収入が減る可能性もあるので、節約を心がけて。",
                    "借金やローンは避けるべき時期です。"
                ],
                travel: [
                    "遠出は控えるのが無難。どうしても行く場合は細心の注意を。",
                    "トラブルに巻き込まれやすいので、慎重に行動を。",
                    "今は旅行よりも、身近な場所で過ごすことをお勧めします。"
                ],
                lost: [
                    "見つからない場合は諦めることも必要です。今後の管理を見直してください。",
                    "失くしたものに執着せず、前を向きましょう。",
                    "この経験を教訓に、物の管理方法を改善しましょう。"
                ],
                trouble: [
                    "トラブルに見舞われやすい時期。感情的にならず、冷静に。",
                    "問題が大きくなる前に、早めの対処を心がけて。",
                    "専門家や信頼できる人に相談することも大切です。"
                ]
            },
            daikyo: {
                wish: [
                    "今は願いが叶いにくい時期ですが、必ず好転します。希望を捨てずに。",
                    "大きな願いは一旦保留にし、小さな目標から始めましょう。",
                    "この困難な時期を乗り越えることで、より強くなれます。"
                ],
                health: [
                    "健康には特に注意が必要です。少しでも不調を感じたら休息を。",
                    "無理は絶対に禁物。体を第一に考えて行動しましょう。",
                    "医師の診断を受けることをお勧めします。"
                ],
                work: [
                    "仕事では大きな困難に直面するかもしれません。でも必ず乗り越えられます。",
                    "今は耐える時期。無理な挑戦は避けましょう。",
                    "基本に忠実に、慎重に仕事を進めてください。"
                ],
                love: [
                    "恋愛は今は控えめに。自分を大切にする時期です。",
                    "相手との関係に問題がある場合は、一度距離を置くことも。",
                    "今は恋愛よりも、自己成長に集中すべき時期です。"
                ],
                study: [
                    "学習は困難を感じるかもしれませんが、諦めないでください。",
                    "今の苦労は将来の糧となります。コツコツと続けましょう。",
                    "基礎からやり直すことで、新しい発見があるでしょう。"
                ],
                money: [
                    "金銭面では特に注意が必要です。支出を最小限に抑えて。",
                    "今は守りの時期。新しい投資は避けましょう。",
                    "家計の見直しをして、無駄を省くことが大切です。"
                ],
                travel: [
                    "旅行は延期することをお勧めします。今は動かない方が賢明。",
                    "どうしても必要な移動以外は控えましょう。",
                    "家で過ごす時間を充実させることに集中を。"
                ],
                lost: [
                    "失くしたものは戻ってこない可能性が高いです。気持ちを切り替えて。",
                    "物への執着を手放し、新しいスタートを切りましょう。",
                    "この経験から学び、今後に活かしてください。"
                ],
                trouble: [
                    "大きなトラブルに注意。でも必ず解決策はあります。一人で抱え込まないで。",
                    "問題は深刻かもしれませんが、冷静に対処すれば乗り越えられます。",
                    "信頼できる人に相談し、サポートを求めることが大切です。"
                ]
            }
        };

        // メインアプリケーションクラス
        class OmikujiApp {
            constructor() {
                this.currentScreen = 'main';
                this.isAnimating = false;
                this.initializeElements();
                this.bindEvents();
                this.expandAdviceData();
            }

            initializeElements() {
                this.screens = {
                    main: document.getElementById('main-screen'),
                    loading: document.getElementById('loading-screen'),
                    result: document.getElementById('result-screen')
                };
                
                this.buttons = {
                    draw: document.getElementById('draw-button'),
                    retry: document.getElementById('retry-button')
                };
                
                this.resultElements = {
                    fortuneName: document.getElementById('fortune-name'),
                    fortuneIcon: document.getElementById('fortune-icon'),
                    header: document.getElementById('result-header')
                };
                
                this.adviceElements = {
                    wish: document.getElementById('advice-wish'),
                    health: document.getElementById('advice-health'),
                    work: document.getElementById('advice-work'),
                    love: document.getElementById('advice-love'),
                    study: document.getElementById('advice-study'),
                    money: document.getElementById('advice-money'),
                    travel: document.getElementById('advice-travel'),
                    lost: document.getElementById('advice-lost'),
                    trouble: document.getElementById('advice-trouble')
                };
            }

            bindEvents() {
                this.buttons.draw.addEventListener('click', () => this.drawOmikuji());
                this.buttons.retry.addEventListener('click', () => this.resetToMain());
                
                if ('ontouchstart' in window) {
                    this.buttons.draw.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        this.drawOmikuji();
                    });
                    
                    this.buttons.retry.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        this.resetToMain();
                    });
                }
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        if (this.currentScreen === 'main' && !this.isAnimating) {
                            this.drawOmikuji();
                        } else if (this.currentScreen === 'result' && !this.isAnimating) {
                            this.resetToMain();
                        }
                    }
                });
            }

            expandAdviceData() {
                // 各運勢のアドバイスを20パターンに拡張
                Object.keys(ADVICE_DATA).forEach(fortune => {
                    Object.keys(this.adviceElements).forEach(category => {
                        if (!ADVICE_DATA[fortune][category]) {
                            ADVICE_DATA[fortune][category] = [];
                        }
                        
                        const currentAdvice = ADVICE_DATA[fortune][category];
                        const baseCount = currentAdvice.length;
                        
                        if (baseCount < 20) {
                            for (let i = baseCount; i < 20; i++) {
                                const baseIndex = i % baseCount;
                                const variation = Math.floor(i / baseCount);
                                
                                if (baseCount > 0) {
                                    // 既存のアドバイスをベースにバリエーションを作成
                                    let newAdvice = currentAdvice[baseIndex];
                                    
                                    // バリエーションを追加
                                    if (variation === 1) {
                                        newAdvice = newAdvice.replace(/。/g, '！');
                                    } else if (variation === 2) {
                                        newAdvice = '今日は特に' + newAdvice;
                                    } else if (variation === 3) {
                                        newAdvice = newAdvice + 'きっと良い結果が待っています。';
                                    }
                                    
                                    ADVICE_DATA[fortune][category].push(newAdvice);
                                } else {
                                    // デフォルトアドバイスを生成
                                    ADVICE_DATA[fortune][category].push(this.getDefaultAdvice(fortune, category, i));
                                }
                            }
                        }
                    });
                });
            }

            getDefaultAdvice(fortune, category, index) {
                const templates = {
                    daikichi: "素晴らしい運勢です。",
                    chukichi: "良い運勢です。",
                    shokichi: "穏やかな運勢です。",
                    kichi: "安定した運勢です。",
                    suekichi: "慎重に進めば良い結果が。",
                    kyo: "注意が必要な時期です。",
                    daikyo: "今は耐える時期です。"
                };
                
                return `${templates[fortune]} (パターン${index + 1})`;
            }

            showScreen(screenName) {
                Object.keys(this.screens).forEach(key => {
                    if (key === screenName) {
                        this.screens[key].classList.add('active');
                    } else {
                        this.screens[key].classList.remove('active');
                    }
                });
                this.currentScreen = screenName;
            }

            drawOmikuji() {
                if (this.isAnimating) return;
                
                this.isAnimating = true;
                
                if ('vibrate' in navigator) {
                    navigator.vibrate(50);
                }
                
                this.showScreen('loading');
                
                setTimeout(() => {
                    const fortune = this.selectFortune();
                    const advice = this.generateAdvice(fortune);
                    this.displayResult(fortune, advice);
                    this.showScreen('result');
                    this.isAnimating = false;
                }, 2500);
            }

            selectFortune() {
                const totalWeight = Object.values(FORTUNE_CONFIG).reduce((sum, config) => sum + config.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (const [key, config] of Object.entries(FORTUNE_CONFIG)) {
                    random -= config.weight;
                    if (random <= 0) {
                        return key;
                    }
                }
                
                return 'chukichi';
            }

            generateAdvice(fortune) {
                const advice = {};
                const fortuneData = ADVICE_DATA[fortune];
                
                Object.keys(this.adviceElements).forEach(category => {
                    if (fortuneData[category] && fortuneData[category].length > 0) {
                        const randomIndex = Math.floor(Math.random() * fortuneData[category].length);
                        advice[category] = fortuneData[category][randomIndex];
                    } else {
                        advice[category] = "運勢に従って行動しましょう。";
                    }
                });
                
                return advice;
            }

            displayResult(fortune, advice) {
                const config = FORTUNE_CONFIG[fortune];
                
                this.resultElements.fortuneName.textContent = config.name;
                this.resultElements.fortuneIcon.textContent = config.icon;
                this.resultElements.header.className = `result-header ${config.class}`;
                
                Object.keys(this.adviceElements).forEach(category => {
                    this.adviceElements[category].textContent = advice[category];
                });
                
                const scrollContainer = document.querySelector('.advice-scroll');
                if (scrollContainer) {
                    scrollContainer.scrollTop = 0;
                }
                
                this.animateResult();
            }

            animateResult() {
                const adviceItems = document.querySelectorAll('.advice-item');
                adviceItems.forEach((item, index) => {
                    item.style.opacity = '0';
                    item.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        item.style.transition = 'all 0.5s ease';
                        item.style.opacity = '1';
                        item.style.transform = 'translateY(0)';
                    }, index * 100);
                });
            }

            resetToMain() {
                if (this.isAnimating) return;
                
                this.isAnimating = true;
                
                const adviceItems = document.querySelectorAll('.advice-item');
                adviceItems.forEach(item => {
                    item.style.opacity = '';
                    item.style.transform = '';
                    item.style.transition = '';
                });
                
                setTimeout(() => {
                    this.showScreen('main');
                    this.isAnimating = false;
                }, 100);
            }
        }

        // アプリケーションの初期化
        document.addEventListener('DOMContentLoaded', () => {
            new OmikujiApp();
        });
    </script>
</body>
</html>
